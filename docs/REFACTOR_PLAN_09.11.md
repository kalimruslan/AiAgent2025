# üìã –ü–ª–∞–Ω –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ü—Ä–æ–µ–∫—Ç–∞ LlmAgent2025
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 09.11.2025

## üéØ –¶–µ–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
1. –°–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ Clean Architecture
2. –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–ª–≥–∞
3. –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏
4. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
5. –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–æ–¥—É–ª–µ–π

---

## ‚ö° –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (High Priority)

### 1.1 –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞ ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
**–ü—Ä–æ–±–ª–µ–º–∞:** 202 —Å—Ç—Ä–æ–∫–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞, —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ use cases

**–î–µ–π—Å—Ç–≤–∏—è:**
- [x] –£–¥–∞–ª–∏—Ç—å `llm-data/src/commonMain/kotlin/ru.llm.agent/McpClientOld.kt` (–≤–µ—Å—å —Ñ–∞–π–ª –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω)
- [x] –£–¥–∞–ª–∏—Ç—å `llm-domain/src/commonMain/kotlin/ru.llm.agent/usecase/old/SendMessageToYandexGptUseCase.kt`
- [x] –£–¥–∞–ª–∏—Ç—å `llm-domain/src/commonMain/kotlin/ru.llm.agent/usecase/old/SendMessageToProxyUseCase.kt`
- [x] –£–¥–∞–ª–∏—Ç—å –ø–∞–ø–∫—É `llm-domain/.../usecase/old/` –ø–æ–ª–Ω–æ—Å—Ç—å—é
- [x] –£–±—Ä–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö use cases –∏–∑ `DomainLayerKoinModule.kt` (—Å—Ç—Ä–æ–∫–∏ 22-26, 59-63)
- [x] –û—á–∏—Å—Ç–∏—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –≤ `ExecuteChainTwoAgentsUseCase.kt` (—Å—Ç—Ä–æ–∫–∏ 96-156)
- [x] –û—á–∏—Å—Ç–∏—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –≤ `InteractYaGptWithMcpService.kt` (—Å—Ç—Ä–æ–∫–∏ 122-127)

**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π (–∫–æ–¥ —É–∂–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–¥–∞–ª–µ–Ω–æ ~351 —Å—Ç—Ä–æ–∫–∞ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞, 3 —Ñ–∞–π–ª–∞, 2 —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ DI

---

### 1.2 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

#### 1.2.1 –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä—è–º–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è llm-data –≤ llm-app ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞—Ä—É—à–µ–Ω–∏–µ Clean Architecture - app –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∫–ª–∞—Å—Å—ã –∏–∑ data layer –Ω–∞–ø—Ä—è–º—É—é

**–î–µ–π—Å—Ç–≤–∏—è:**
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≥–¥–µ –≤ `llm-app` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–ª–∞—Å—Å—ã –∏–∑ `llm-data`
- [x] –°–æ–∑–¥–∞—Ç—å `platformDatabaseModule` –≤ llm-data –¥–ª—è Android –∏ Desktop
- [x] –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ `DatabaseDriverFactory` –∏ `MessageDatabase` –∏–∑ llm-app –≤ llm-data
- [x] –û–±–Ω–æ–≤–∏—Ç—å InitKoin –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª–µ–π –∏–∑ llm-data
- [x] –£–¥–∞–ª–∏—Ç—å –ø—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `DatabaseDriverFactory` –∏ `MessageDatabase` –∏–∑ llm-app
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ llm-data –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è DI –º–æ–¥—É–ª–µ–π

**–û—Ü–µ–Ω–∫–∞:** 3 —á–∞—Å–∞
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π (–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ DI)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–¥–∞–ª–µ–Ω—ã –ø—Ä—è–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã DatabaseDriverFactory –∏ MessageDatabase –∏–∑ llm-app. –¢–µ–ø–µ—Ä—å –æ–Ω–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ DI –º–æ–¥—É–ª–∏ –≤ llm-data.

#### 1.2.2 –£–¥–∞–ª–µ–Ω–∏–µ java.util.logging –∏–∑ domain layer ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞:** Platform-specific –∫–æ–¥ –≤ domain layer (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å platform-agnostic)

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- `ExecuteCommitteeUseCase.kt:10`
- `InteractYaGptWithMcpService.kt:16`

**–î–µ–π—Å—Ç–≤–∏—è:**
- [x] –°–æ–∑–¥–∞—Ç—å `expect interface Logger` –≤ `core/utils`
- [x] –°–æ–∑–¥–∞—Ç—å `actual class AndroidLogger` –¥–ª—è Android
- [x] –°–æ–∑–¥–∞—Ç—å `actual class DesktopLogger` –¥–ª—è Desktop
- [x] –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `java.util.logging.Logger` –Ω–∞ –Ω–æ–≤—ã–π –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π Logger
- [x] –ò–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å Logger —á–µ—Ä–µ–∑ Koin (–∏—Å–ø–æ–ª—å–∑—É—è createLogger factory function)
- [x] –û–±–Ω–æ–≤–∏—Ç—å `ExecuteCommitteeUseCase` –∏ `InteractYaGptWithMcpService`

**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∑–¥–∞–Ω –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π Logger –≤ core/utils —Å actual —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏ –¥–ª—è Android (—á–µ—Ä–µ–∑ android.util.Log) –∏ Desktop (—á–µ—Ä–µ–∑ java.util.logging). –í—Å–µ use cases –≤ domain layer —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞—é—Ç logger —á–µ—Ä–µ–∑ DI.

#### 1.2.3 –í—ã–Ω–µ—Å—Ç–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏–∑ repositories –≤ use cases
**–ü—Ä–æ–±–ª–µ–º–∞:** `ConversationRepositoryImpl` —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (–ø–∞—Ä—Å–∏–Ω–≥ JSON, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤)

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `ParseAssistantResponseUseCase` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
- [ ] –°–æ–∑–¥–∞—Ç—å `SystemPromptBuilder` –≤ domain layer –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- [ ] –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ repository –≤ use case
- [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å –º–µ—Ç–æ–¥—ã repository –¥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ CRUD + API –≤—ã–∑–æ–≤–æ–≤

**–û—Ü–µ–Ω–∫–∞:** 6 —á–∞—Å–æ–≤
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π (–∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–ª—é—á–µ–≤–æ–π –ª–æ–≥–∏–∫–µ)

---

### 1.3 –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

#### 1.3.1 –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ConversationRepositoryImpl (446 —Å—Ç—Ä–æ–∫) ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π –≤ –æ–¥–Ω–æ–º –∫–ª–∞—Å—Å–µ

**–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
ConversationRepositoryImpl ‚Üí —É–ø—Ä–æ—â–µ–Ω
‚Üì
‚îú‚îÄ‚îÄ ConversationRepository (–Ω–æ–≤—ã–π) - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ ‚úì
‚îú‚îÄ‚îÄ MessageSendingService - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ API ‚úì
‚îú‚îÄ‚îÄ ProviderConfigRepository - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ LLM ‚úì
‚îî‚îÄ‚îÄ ExpertOpinionRepository - —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚úì
```

**–î–µ–π—Å—Ç–≤–∏—è:**
- [x] –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `MessageSendingService` –≤ domain
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `MessageSendingServiceImpl` –≤ data (–º–µ—Ç–æ–¥—ã sendMessageToYandex/Proxy)
- [x] –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ProviderConfigRepository` –≤ domain
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ProviderConfigRepositoryImpl` –≤ data
- [x] –£–ø—Ä–æ—Å—Ç–∏—Ç—å `ConversationRepositoryImpl` –¥–æ –ø—Ä–æ—Å—Ç—ã—Ö CRUD –æ–ø–µ—Ä–∞—Ü–∏–π (440 —Å—Ç—Ä–æ–∫ ‚Üí 190 —Å—Ç—Ä–æ–∫)
- [x] –°–æ–∑–¥–∞—Ç—å `ParseAssistantResponseUseCase` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
- [x] –°–æ–∑–¥–∞—Ç—å `SystemPromptBuilder` –≤ domain layer
- [x] –°–æ–∑–¥–∞—Ç—å `SendMessageWithCustomPromptUseCase` –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- [x] –°–æ–∑–¥–∞—Ç—å `GetSelectedProviderUseCase` –∏ `SaveSelectedProviderUseCase`
- [x] –û–±–Ω–æ–≤–∏—Ç—å use cases –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [x] –û–±–Ω–æ–≤–∏—Ç—å Koin modules (–¥–æ–±–∞–≤–ª–µ–Ω servicesModule)
- [x] –û–±–Ω–æ–≤–∏—Ç—å ConversationViewModel –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è use cases
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É –ø—Ä–æ–µ–∫—Ç–∞

**–û—Ü–µ–Ω–∫–∞:** 8 —á–∞—Å–æ–≤
**–†–∏—Å–∫:** –í—ã—Å–æ–∫–∏–π (—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ConversationRepositoryImpl —Å–æ–∫—Ä–∞—â–µ–Ω —Å 440 –¥–æ 190 —Å—Ç—Ä–æ–∫ (–±–æ–ª–µ–µ —á–µ–º –≤ 2 —Ä–∞–∑–∞)
- –°–æ–∑–¥–∞–Ω–æ 2 –Ω–æ–≤—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (MessageSendingService, ProviderConfigRepository)
- –°–æ–∑–¥–∞–Ω–æ 5 –Ω–æ–≤—ã—Ö use cases
- Clean Architecture —Å–æ–±–ª—é–¥–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è

#### 1.3.2 –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ExecuteCommitteeUseCase (239 —Å—Ç—Ä–æ–∫) ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ª–æ–≥–∏–∫–∏ –≤ –æ–¥–Ω–æ–º use case

**–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
ExecuteCommitteeUseCase (239 —Å—Ç—Ä–æ–∫) ‚Üí —É–ø—Ä–æ—â–µ–Ω –¥–æ 183 —Å—Ç—Ä–æ–∫
‚Üì
‚îú‚îÄ‚îÄ ExecuteCommitteeUseCase - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è (183 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ SynthesizeExpertOpinionsUseCase - —Å–∏–Ω—Ç–µ–∑ –º–Ω–µ–Ω–∏–π (111 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ‚îÄ SystemPromptBuilder - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –¥–æ–ø–æ–ª–Ω–µ–Ω)
```

**–î–µ–π—Å—Ç–≤–∏—è:**
- [x] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –≤ `SystemPromptBuilder`: `buildUserQuestionWithOpinions()`, `ExpertOpinionData`
- [x] –°–æ–∑–¥–∞—Ç—å `SynthesizeExpertOpinionsUseCase` —Å –ª–æ–≥–∏–∫–æ–π —Å–∏–Ω—Ç–µ–∑–∞ (111 —Å—Ç—Ä–æ–∫)
- [x] –£–ø—Ä–æ—Å—Ç–∏—Ç—å `ExecuteCommitteeUseCase` –¥–æ —É—Ä–æ–≤–Ω—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (239 ‚Üí 183 —Å—Ç—Ä–æ–∫–∏)
- [x] –û–±–Ω–æ–≤–∏—Ç—å Koin DI (–¥–æ–±–∞–≤–ª–µ–Ω SynthesizeExpertOpinionsUseCase)
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É –ø—Ä–æ–µ–∫—Ç–∞

**–û—Ü–µ–Ω–∫–∞:** 5 —á–∞—Å–æ–≤
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ExecuteCommitteeUseCase —Å–æ–∫—Ä–∞—â–µ–Ω —Å 239 –¥–æ 183 —Å—Ç—Ä–æ–∫ (—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ ~24%)
- –°–æ–∑–¥–∞–Ω SynthesizeExpertOpinionsUseCase –¥–ª—è –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ —Å–∏–Ω—Ç–µ–∑–∞
- –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –º–µ—Ç–æ–¥—ã buildSynthesisPrompt() –∏ hardcoded –ø—Ä–æ–º–ø—Ç—ã
- SystemPromptBuilder —Ä–∞—Å—à–∏—Ä–µ–Ω –º–µ—Ç–æ–¥–æ–º buildUserQuestionWithOpinions()
- –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è

#### 1.3.3 –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ConversationViewModel (251 —Å—Ç—Ä–æ–∫) ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π, –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ repository

**–î–µ–π—Å—Ç–≤–∏—è:**
- [x] –°–æ–∑–¥–∞–Ω `GetMessagesWithExpertOpinionsUseCase` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å –º–Ω–µ–Ω–∏—è–º–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
- [x] –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `conversationRepository` –∏–∑ ViewModel
- [x] –û–±–Ω–æ–≤–ª–µ–Ω ConversationViewModel –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è use case –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞ repository
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∞ DI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¥–æ–±–∞–≤–ª–µ–Ω GetMessagesWithExpertOpinionsUseCase)
- [x] –£–¥–∞–ª–µ–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç ConversationRepository
- [x] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–û—Ü–µ–Ω–∫–∞:** 6 —á–∞—Å–æ–≤
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ConversationViewModel —Ç–µ–ø–µ—Ä—å –Ω–µ –∏–º–µ–µ—Ç –ø—Ä—è–º—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç repository
- –°–æ–∑–¥–∞–Ω GetMessagesWithExpertOpinionsUseCase (23 —Å—Ç—Ä–æ–∫–∏)
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ use cases
- Clean Architecture —Å–æ–±–ª—é–¥–∞–µ—Ç—Å—è –Ω–∞ 100%
- –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è

---

## üîß –§–∞–∑–∞ 2: –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ (Medium Priority)

### 2.1 –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

#### 2.1.1 –û–±—â–∏–π —à–∞–±–ª–æ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** `sendMessageToYandex()` –∏ `sendMessageToProxy()` –ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å sealed class `LlmProvider` —Å `Yandex` –∏ `Proxy` –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
- [ ] –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ `sendMessage(provider: LlmProvider, ...)`
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å strategy pattern –¥–ª—è —Ä–∞–∑–Ω—ã—Ö API –∫–ª–∏–µ–Ω—Ç–æ–≤
- [ ] –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –º–µ—Ç–æ–¥—ã

**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

#### 2.1.2 –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞—Ä—Å–∏–Ω–≥ `AssistantJsonAnswer` –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `JsonParser` utility –∫–ª–∞—Å—Å –≤ `core/utils`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `parseAssistantResponse(text: String): Result<AssistantJsonAnswer>`
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `Json.decodeFromString` –Ω–∞ –Ω–æ–≤—ã–π parser
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞

**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

#### 2.1.3 –°–∏—Å—Ç–µ–º–∞ —à–∞–±–ª–æ–Ω–æ–≤ –ø—Ä–æ–º–ø—Ç–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã —Ö–∞—Ä–¥–∫–æ–¥—è—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `PromptTemplate` data class –≤ domain
- [ ] –°–æ–∑–¥–∞—Ç—å `PromptRepository` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤
- [ ] –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î –∏–ª–∏ config —Ñ–∞–π–ª–∞—Ö
- [ ] –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã:
  - Default system prompt
  - Expert prompts
  - Synthesis prompt
  - Chain agent prompts

**–û—Ü–µ–Ω–∫–∞:** 5 —á–∞—Å–æ–≤
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π

---

### 2.2 –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

#### 2.2.1 –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è error handling
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–º–µ—à–∞–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã (NetworkResult, exceptions, null)

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `NetworkResult<T>` –≤–µ–∑–¥–µ
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:
```kotlin
sealed class DomainError {
    data class NetworkError(val code: Int, val message: String) : DomainError()
    data class ParseError(val rawData: String) : DomainError()
    data class DatabaseError(val exception: Throwable) : DomainError()
    data class ValidationError(val field: String) : DomainError()
}
```
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ use cases –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ `NetworkResult<T, DomainError>`
- [ ] –î–æ–±–∞–≤–∏—Ç—å error mapping –≤ UI layer

**–û—Ü–µ–Ω–∫–∞:** 6 —á–∞—Å–æ–≤
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π

#### 2.2.2 –£–ª—É—á—à–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞ "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- [ ] –í–∫–ª—é—á–∏—Ç—å stacktrace –≤ error logging
- [ ] –î–æ–±–∞–≤–∏—Ç—å error codes –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] –°–æ–∑–¥–∞—Ç—å user-friendly —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è UI

**–û—Ü–µ–Ω–∫–∞:** 3 —á–∞—Å–∞
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

---

### 2.3 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç

#### 2.3.1 –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ LLM
**–ü—Ä–æ–±–ª–µ–º–∞:** –•–∞—Ä–¥–∫–æ–¥ –º–æ–¥–µ–ª–µ–π, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä, —Ç–æ–∫–µ–Ω–æ–≤

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `LlmConfig` data class:
```kotlin
data class LlmConfig(
    val modelId: String,
    val temperature: Float,
    val maxTokens: Int,
    val systemPrompt: String?
)
```
- [ ] –°–æ–∑–¥–∞—Ç—å `LlmConfigRepository` –≤ domain
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –≤—Å–µ magic numbers –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ UI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

#### 2.3.2 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –•–∞—Ä–¥–∫–æ–¥ URLs –∏ model IDs

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `ProviderConfig` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –≤ separate config —Ñ–∞–π–ª –∏–ª–∏ BuildConfig
- [ ] –°–æ–∑–¥–∞—Ç—å enum `LlmProviderType` –¥–ª—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å UI –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

**–û—Ü–µ–Ω–∫–∞:** 3 —á–∞—Å–∞
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

---

## üé® –§–∞–∑–∞ 3: –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (Low Priority)

### 3.1 –†–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–∫–µ—Ç–æ–≤

#### 3.1.1 –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –≤ feature modules
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞–∫–µ—Ç `compose.presenter` –Ω–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç feature domain

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] `features/conversation/compose/presenter` ‚Üí `features/conversation/presentation`
- [ ] `features/addoptions/compose/presenter` ‚Üí `features/addoptions/presentation`
- [ ] –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ sub-packages:
  - `presentation/viewmodel/`
  - `presentation/ui/`
  - `presentation/state/`

**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

#### 3.1.2 –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ UI –∏ ViewModel
**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –¥–ª—è Composables –∏ ViewModels
- [ ] –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å internal –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –≥–¥–µ –Ω—É–∂–Ω–æ

**–û—Ü–µ–Ω–∫–∞:** 1 —á–∞—Å
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

---

### 3.2 –£–ª—É—á—à–µ–Ω–∏–µ DI

#### 3.2.1 –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö scopes
**–ü—Ä–æ–±–ª–µ–º–∞:** Scopes –æ–±—ä—è–≤–ª–µ–Ω—ã –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –£–¥–∞–ª–∏—Ç—å –ø—É—Å—Ç—ã–µ scope definitions –∏–∑ `conversationKoinModule()`
- [ ] –£–¥–∞–ª–∏—Ç—å –ø—É—Å—Ç—ã–µ scope definitions –∏–∑ `optionsKoinModule()`
- [ ] –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ scoped dependencies

**–û—Ü–µ–Ω–∫–∞:** 30 –º–∏–Ω—É—Ç
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

#### 3.2.2 –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π
**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `useCasesModule` ‚Üí `domainKoinModule`
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å: `*KoinModule` –∏–ª–∏ `*Module`
- [ ] –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å related definitions

**–û—Ü–µ–Ω–∫–∞:** 1 —á–∞—Å
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

#### 3.2.3 –£–ª—É—á—à–µ–Ω–∏–µ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**–ü—Ä–æ–±–ª–µ–º–∞:** Named HttpClients –Ω–µ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å qualifier constants:
```kotlin
object HttpClientQualifier {
    val Yandex = named("Yandex")
    val ProxyOpenAI = named("ProxyApiOpenAI")
    val ProxyOpenRouter = named("ProxyApiOpenRouter")
}
```
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ qualifiers –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫

**–û—Ü–µ–Ω–∫–∞:** 1 —á–∞—Å
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

---

### 3.3 –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### 3.3.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CLAUDE.md
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —É–ø–æ–º–∏–Ω–∞–µ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –£–¥–∞–ª–∏—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏—è `features/difftwomodels`
- [ ] –£–¥–∞–ª–∏—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏—è `features/interactiontwoagents`
- [ ] –£–¥–∞–ª–∏—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏—è `features/tokens`
- [ ] –£–¥–∞–ª–∏—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏—è `features/mcpclient`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–¥—É–ª–µ–π
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

**–û—Ü–µ–Ω–∫–∞:** 1 —á–∞—Å
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

#### 3.3.2 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ KDoc
**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å KDoc –∫ –ø—É–±–ª–∏—á–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º –≤ domain layer
- [ ] –î–æ–±–∞–≤–∏—Ç—å KDoc –∫ use cases
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

---

### 3.4 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

#### 3.4.1 –§–∏–∫—Å –ø–µ—Ä–µ–¥–∞—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ savedStateHandle –≤ `StartApp.kt`

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É 48: —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ `currentBackStackEntry` –≤–º–µ—Å—Ç–æ `previousBackStackEntry`
- [ ] –î–æ–±–∞–≤–∏—Ç—å null-safety –ø—Ä–æ–≤–µ—Ä–∫–∏
- [ ] –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (Navigation 2.8+)
- [ ] –£–¥–∞–ª–∏—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ `"default_conversation"`

**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

---

## üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞

### –ü–æ —Ñ–∞–∑–∞–º:
- **–§–∞–∑–∞ 1 (High Priority):** ~34 —á–∞—Å–∞ (~4-5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π)
- **–§–∞–∑–∞ 2 (Medium Priority):** ~27 —á–∞—Å–æ–≤ (~3-4 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è)
- **–§–∞–∑–∞ 3 (Low Priority):** ~12.5 —á–∞—Å–æ–≤ (~1.5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è)

**–ò—Ç–æ–≥–æ:** ~73.5 —á–∞—Å–∞ (~9-11 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π)

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–∏—Å–∫–∞–º:
- üü¢ **–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫:** ~40% –∑–∞–¥–∞—á
- üü° **–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫:** ~50% –∑–∞–¥–∞—á
- üî¥ **–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫:** ~10% –∑–∞–¥–∞—á (ConversationRepositoryImpl refactoring)

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ù–µ–¥–µ–ª—è 1: –û—á–∏—Å—Ç–∫–∞ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
1. –î–µ–Ω—å 1-2: –§–∞–∑–∞ 1.1 - –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞ ‚úÖ
2. –î–µ–Ω—å 2-3: –§–∞–∑–∞ 1.2 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π
3. –î–µ–Ω—å 4-5: –§–∞–∑–∞ 1.3.1 - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ConversationRepositoryImpl

### –ù–µ–¥–µ–ª—è 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
4. –î–µ–Ω—å 6: –§–∞–∑–∞ 1.3.2 - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ExecuteCommitteeUseCase
5. –î–µ–Ω—å 7: –§–∞–∑–∞ 1.3.3 - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ConversationViewModel
6. –î–µ–Ω—å 8-9: –§–∞–∑–∞ 2.1 - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
7. –î–µ–Ω—å 9-10: –§–∞–∑–∞ 2.2 - –£–ª—É—á—à–µ–Ω–∏–µ error handling

### –ù–µ–¥–µ–ª—è 3: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
8. –î–µ–Ω—å 11: –§–∞–∑–∞ 2.3 - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç
9. –î–µ–Ω—å 11-12: –§–∞–∑–∞ 3 - –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- ‚úÖ 0 –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ - **–í–´–ü–û–õ–ù–ï–ù–û**
- ‚úÖ 0 platform-specific imports –≤ domain layer - **–í–´–ü–û–õ–ù–ï–ù–û**
- ‚è≥ –í—Å–µ repository < 200 —Å—Ç—Ä–æ–∫ - –í –ø—Ä–æ—Ü–µ—Å—Å–µ
- ‚è≥ –í—Å–µ use cases < 150 —Å—Ç—Ä–æ–∫ - –í –ø—Ä–æ—Ü–µ—Å—Å–µ
- ‚è≥ –í—Å–µ ViewModels < 150 —Å—Ç—Ä–æ–∫ - –í –ø—Ä–æ—Ü–µ—Å—Å–µ
- ‚è≥ –ï–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ error handling - –í –ø—Ä–æ—Ü–µ—Å—Å–µ
- ‚è≥ 0 —Ö–∞—Ä–¥–∫–æ–¥–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ - –í –ø—Ä–æ—Ü–µ—Å—Å–µ
- ‚úÖ Clean Architecture —Å–æ–±–ª—é–¥–∞–µ—Ç—Å—è –Ω–∞ 100% - **–ß–ê–°–¢–ò–ß–ù–û** (–ø—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ llm-data —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ)
- ‚è≥ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ - –í –ø—Ä–æ—Ü–µ—Å—Å–µ

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 09.11.2025
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ **–§–∞–∑–∞ 1.1 - –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞**
  - –£–¥–∞–ª–µ–Ω–æ ~351 —Å—Ç—Ä–æ–∫–∞ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞
  - –£–¥–∞–ª–µ–Ω–æ 3 —Ñ–∞–π–ª–∞
  - –£–¥–∞–ª–µ–Ω–æ 2 —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ DI
  - –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ **–§–∞–∑–∞ 1.2 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π**
  - –°–æ–∑–¥–∞–Ω –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π Logger –≤ core/utils
  - –£–¥–∞–ª–µ–Ω—ã –ø—Ä—è–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã DatabaseDriverFactory –∏ MessageDatabase –∏–∑ llm-app
  - –í—Å–µ platform-specific –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–±—Ä–∞–Ω—ã –∏–∑ domain layer
  - –°–æ–∑–¥–∞–Ω platformDatabaseModule –¥–ª—è Android –∏ Desktop –≤ llm-data
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ DI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ llm-app –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª–µ–π –∏–∑ llm-data
  - –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è

### 10.11.2025
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ **–§–∞–∑–∞ 1.3.1 - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ConversationRepositoryImpl**
  - –°–æ–∑–¥–∞–Ω MessageSendingService (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ domain + —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ data)
  - –°–æ–∑–¥–∞–Ω ProviderConfigRepository (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ domain + —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ data)
  - ConversationRepositoryImpl —É–ø—Ä–æ—â–µ–Ω —Å 440 –¥–æ 190 —Å—Ç—Ä–æ–∫ (—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ >2x)
  - –°–æ–∑–¥–∞–Ω–æ 5 –Ω–æ–≤—ã—Ö use cases:
    - ParseAssistantResponseUseCase
    - SystemPromptBuilder
    - SendMessageWithCustomPromptUseCase
    - GetSelectedProviderUseCase
    - SaveSelectedProviderUseCase
  - –û–±–Ω–æ–≤–ª–µ–Ω SendConversationMessageUseCase –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  - –û–±–Ω–æ–≤–ª–µ–Ω ExecuteCommitteeUseCase –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è SendMessageWithCustomPromptUseCase
  - –°–æ–∑–¥–∞–Ω servicesModule –≤ DataLayerKoinModule
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ DI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö
  - –û–±–Ω–æ–≤–ª–µ–Ω ConversationViewModel –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è use cases –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ repository
  - Clean Architecture —Å–æ–±–ª—é–¥–∞–µ—Ç—Å—è –Ω–∞ 100%
  - –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ **–§–∞–∑–∞ 1.3.2 - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ExecuteCommitteeUseCase**
  - –†–∞—Å—à–∏—Ä–µ–Ω SystemPromptBuilder –Ω–æ–≤—ã–º –º–µ—Ç–æ–¥–æ–º buildUserQuestionWithOpinions()
  - –î–æ–±–∞–≤–ª–µ–Ω data class ExpertOpinionData –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –º–Ω–µ–Ω–∏–π —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
  - –°–æ–∑–¥–∞–Ω SynthesizeExpertOpinionsUseCase (111 —Å—Ç—Ä–æ–∫) –¥–ª—è –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ —Å–∏–Ω—Ç–µ–∑–∞
  - ExecuteCommitteeUseCase —É–ø—Ä–æ—â–µ–Ω —Å 239 –¥–æ 183 —Å—Ç—Ä–æ–∫ (—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ ~24%)
  - –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –º–µ—Ç–æ–¥—ã buildSynthesisPrompt() –∏ hardcoded –ø—Ä–æ–º–ø—Ç—ã
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ DI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¥–æ–±–∞–≤–ª–µ–Ω SynthesizeExpertOpinionsUseCase)
  - –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ **–§–∞–∑–∞ 1.3.3 - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ConversationViewModel**
  - –°–æ–∑–¥–∞–Ω GetMessagesWithExpertOpinionsUseCase (23 —Å—Ç—Ä–æ–∫–∏)
  - –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã conversationRepository –∏–∑ ViewModel
  - –û–±–Ω–æ–≤–ª–µ–Ω ConversationViewModel –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è GetMessagesWithExpertOpinionsUseCase
  - –£–¥–∞–ª–µ–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç ConversationRepository
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ DI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¥–æ–±–∞–≤–ª–µ–Ω GetMessagesWithExpertOpinionsUseCase –≤ DomainLayerKoinModule –∏ ConversationKoin)
  - ConversationViewModel —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ use cases (0 –ø—Ä—è–º—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ repository)
  - Clean Architecture —Å–æ–±–ª—é–¥–∞–µ—Ç—Å—è –Ω–∞ 100%
  - –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è
