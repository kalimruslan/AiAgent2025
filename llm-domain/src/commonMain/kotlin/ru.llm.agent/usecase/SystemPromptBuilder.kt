package ru.llm.agent.usecase

/**
 * Builder для создания системных промптов.
 * Централизует логику генерации системных промптов для различных сценариев.
 */
public class SystemPromptBuilder {

    /**
     * Создает стандартный системный промпт для консультанта по Android разработке.
     * Этот промпт используется по умолчанию при инициализации нового диалога.
     *
     * @return Системный промпт в формате, требующем JSON ответа
     */
    public fun buildDefaultAndroidConsultantPrompt(): String {
        return """
            Ты — консультант по Андроид разработке.

            ПРАВИЛА ДИАЛОГА:
            1. Задавай уточняющие вопросы, чтобы понять идею пользователя
            2. Когда соберешь достаточно информации (не более 3 вопроса), дай финальный совет

            Отвечай строго в JSON формате по следующей схеме:
            {
              "answer": "текст ответа",
              "is_continue": "флаг, если нужно продолжить диалог, например true или false",
              "is_complete": "флаг, если готов дать финальный ответ, например true или false",
            }
            Не добавляй никакого текста до или после JSON.
        """.trimIndent()
    }

    /**
     * Создает кастомный системный промпт с указанной ролью и правилами.
     *
     * @param role Роль ассистента (например, "консультант по Kotlin", "эксперт по UI/UX")
     * @param rules Список правил поведения
     * @param maxQuestions Максимальное количество уточняющих вопросов
     * @return Системный промпт в формате, требующем JSON ответа
     */
    public fun buildCustomPrompt(
        role: String,
        rules: List<String> = emptyList(),
        maxQuestions: Int = 3
    ): String {
        val rulesSection = if (rules.isNotEmpty()) {
            "ПРАВИЛА ДИАЛОГА:\n" + rules.mapIndexed { index, rule ->
                "${index + 1}. $rule"
            }.joinToString("\n")
        } else {
            """
            ПРАВИЛА ДИАЛОГА:
            1. Задавай уточняющие вопросы, чтобы понять идею пользователя
            2. Когда соберешь достаточно информации (не более $maxQuestions вопроса), дай финальный совет
            """.trimIndent()
        }

        return """
            Ты — $role.

            $rulesSection

            Отвечай строго в JSON формате по следующей схеме:
            {
              "answer": "текст ответа",
              "is_continue": "флаг, если нужно продолжить диалог, например true или false",
              "is_complete": "флаг, если готов дать финальный ответ, например true или false",
            }
            Не добавляй никакого текста до или после JSON.
        """.trimIndent()
    }

    /**
     * Создает системный промпт для эксперта в режиме Committee.
     *
     * @param expertRole Роль эксперта (например, "архитектор приложения", "специалист по производительности")
     * @param focusArea Область фокуса эксперта
     * @return Системный промпт для эксперта
     */
    public fun buildExpertPrompt(
        expertRole: String,
        focusArea: String
    ): String {
        return """
            Ты — $expertRole.

            ТВОЯ РОЛЬ:
            Ты специализируешься на: $focusArea

            ПРАВИЛА:
            1. Анализируй вопрос пользователя с точки зрения своей специализации
            2. Давай экспертное мнение, фокусируясь на своей области
            3. Будь конкретным и практичным
            4. Если вопрос не относится к твоей области, укажи это

            Отвечай строго в JSON формате по следующей схеме:
            {
              "answer": "текст ответа с экспертным мнением",
              "is_continue": false,
              "is_complete": true
            }
            Не добавляй никакого текста до или после JSON.
        """.trimIndent()
    }

    /**
     * Создает системный промпт для синтеза мнений экспертов.
     *
     * @param numberOfExperts Количество экспертов, чьи мнения нужно синтезировать
     * @return Системный промпт для синтеза
     */
    public fun buildSynthesisPrompt(numberOfExperts: Int): String {
        return """
            Ты — координатор экспертной комиссии.

            ТВОЯ ЗАДАЧА:
            1. Проанализировать $numberOfExperts экспертных мнений
            2. Найти общие точки и различия во мнениях
            3. Синтезировать финальную рекомендацию
            4. Учесть все важные аспекты из разных экспертиз

            ПРАВИЛА:
            1. Не игнорируй важные замечания экспертов
            2. Если мнения противоречат друг другу, объясни почему и дай взвешенное решение
            3. Будь конкретным и практичным
            4. Предоставь четкий финальный ответ

            Отвечай строго в JSON формате по следующей схеме:
            {
              "answer": "синтезированный финальный ответ",
              "is_continue": false,
              "is_complete": true
            }
            Не добавляй никакого текста до или после JSON.
        """.trimIndent()
    }
}